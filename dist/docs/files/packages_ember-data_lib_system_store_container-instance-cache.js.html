<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/ember-data/lib/system/store/container-instance-cache.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ContainerInstanceCache.html">ContainerInstanceCache</a></li>
            
                <li><a href="../classes/DS.html">DS</a></li>
            
                <li><a href="../classes/DS.AbortError.html">DS.AbortError</a></li>
            
                <li><a href="../classes/DS.ActiveModelAdapter.html">DS.ActiveModelAdapter</a></li>
            
                <li><a href="../classes/DS.ActiveModelSerializer.html">DS.ActiveModelSerializer</a></li>
            
                <li><a href="../classes/DS.Adapter.html">DS.Adapter</a></li>
            
                <li><a href="../classes/DS.AdapterError.html">DS.AdapterError</a></li>
            
                <li><a href="../classes/DS.AdapterPopulatedRecordArray.html">DS.AdapterPopulatedRecordArray</a></li>
            
                <li><a href="../classes/DS.BooleanTransform.html">DS.BooleanTransform</a></li>
            
                <li><a href="../classes/DS.BuildURLMixin.html">DS.BuildURLMixin</a></li>
            
                <li><a href="../classes/DS.ContainerProxy.html">DS.ContainerProxy</a></li>
            
                <li><a href="../classes/DS.DateTransform.html">DS.DateTransform</a></li>
            
                <li><a href="../classes/DS.DebugAdapter.html">DS.DebugAdapter</a></li>
            
                <li><a href="../classes/DS.EmbeddedRecordsMixin.html">DS.EmbeddedRecordsMixin</a></li>
            
                <li><a href="../classes/DS.Errors.html">DS.Errors</a></li>
            
                <li><a href="../classes/DS.FilteredRecordArray.html">DS.FilteredRecordArray</a></li>
            
                <li><a href="../classes/DS.FixtureAdapter.html">DS.FixtureAdapter</a></li>
            
                <li><a href="../classes/DS.InternalModel.html">DS.InternalModel</a></li>
            
                <li><a href="../classes/DS.InvalidError.html">DS.InvalidError</a></li>
            
                <li><a href="../classes/DS.JSONAPIAdapter.html">DS.JSONAPIAdapter</a></li>
            
                <li><a href="../classes/DS.JSONAPISerializer.html">DS.JSONAPISerializer</a></li>
            
                <li><a href="../classes/DS.JSONSerializer.html">DS.JSONSerializer</a></li>
            
                <li><a href="../classes/DS.ManyArray.html">DS.ManyArray</a></li>
            
                <li><a href="../classes/DS.Model.html">DS.Model</a></li>
            
                <li><a href="../classes/DS.NumberTransform.html">DS.NumberTransform</a></li>
            
                <li><a href="../classes/DS.PromiseArray.html">DS.PromiseArray</a></li>
            
                <li><a href="../classes/DS.PromiseManyArray.html">DS.PromiseManyArray</a></li>
            
                <li><a href="../classes/DS.PromiseObject.html">DS.PromiseObject</a></li>
            
                <li><a href="../classes/DS.RecordArray.html">DS.RecordArray</a></li>
            
                <li><a href="../classes/DS.RecordArrayManager.html">DS.RecordArrayManager</a></li>
            
                <li><a href="../classes/DS.RESTAdapter.html">DS.RESTAdapter</a></li>
            
                <li><a href="../classes/DS.RESTSerializer.html">DS.RESTSerializer</a></li>
            
                <li><a href="../classes/DS.RootState.html">DS.RootState</a></li>
            
                <li><a href="../classes/DS.Serializer.html">DS.Serializer</a></li>
            
                <li><a href="../classes/DS.Snapshot.html">DS.Snapshot</a></li>
            
                <li><a href="../classes/DS.SnapshotRecordArray.html">DS.SnapshotRecordArray</a></li>
            
                <li><a href="../classes/DS.Store.html">DS.Store</a></li>
            
                <li><a href="../classes/DS.StringTransform.html">DS.StringTransform</a></li>
            
                <li><a href="../classes/DS.TimeoutError.html">DS.TimeoutError</a></li>
            
                <li><a href="../classes/DS.Transform.html">DS.Transform</a></li>
            
                <li><a href="../classes/Ember.Date.html">Ember.Date</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/ember-data.html">ember-data</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: packages/ember-data/lib/system/store/container-instance-cache.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Ember from &#x27;ember&#x27;;

import {
  keysFunc
} from &#x27;ember-data/system/object-polyfills&#x27;;

import EmptyObject from &quot;ember-data/system/empty-object&quot;;

/**
 * The &#x60;ContainerInstanceCache&#x60; serves as a lazy cache for looking up
 * instances of serializers and adapters. It has some additional logic for
 * finding the &#x27;fallback&#x27; adapter or serializer.
 *
 * The &#x27;fallback&#x27; adapter or serializer is an adapter or serializer that is looked up
 * when the preferred lookup fails. For example, say you try to look up &#x60;adapter:post&#x60;,
 * but there is no entry (app/adapters/post.js in EmberCLI) for &#x60;adapter:post&#x60; in the registry.
 *
 * The &#x60;fallbacks&#x60; array passed will then be used; the first entry in the fallbacks array
 * that exists in the container will then be cached for &#x60;adapter:post&#x60;. So, the next time you
 * look up &#x60;adapter:post&#x60;, you&#x27;ll get the &#x60;adapter:application&#x60; instance (or whatever the fallback
 * was if &#x60;adapter:application&#x60; doesn&#x27;t exist).
 *
 * @private
 * @class ContainerInstanceCache
 *
*/
function ContainerInstanceCache(container) {
  this._container  = container;
  this._cache      = new EmptyObject();
}

ContainerInstanceCache.prototype = new EmptyObject();

Ember.merge(ContainerInstanceCache.prototype, {
  get: function(type, preferredKey, fallbacks) {
    let cache = this._cache;
    let preferredLookupKey = &#x60;${type}:${preferredKey}&#x60;;

    if (!(preferredLookupKey in cache)) {
      let instance = this.instanceFor(preferredLookupKey) || this._findInstance(type, fallbacks);
      if (instance) {
        cache[preferredLookupKey] = instance;
      }
    }
    return cache[preferredLookupKey];
  },

  _findInstance: function(type, fallbacks) {
    for (let i = 0, length = fallbacks.length; i &lt; length; i++) {
      let fallback = fallbacks[i];
      let lookupKey = &#x60;${type}:${fallback}&#x60;;
      let instance = this.instanceFor(lookupKey);

      if (instance) {
        return instance;
      }
    }
  },

  instanceFor: function(key) {
    if (key === &#x27;adapter:-rest&#x27;) {
      Ember.deprecate(&#x27;You are currently using the default DS.RESTAdapter adapter. For Ember 2.0 the default adapter will be DS.JSONAPIAdapter. If you would like to continue using DS.RESTAdapter please create an application adapter that extends DS.RESTAdapter.&#x27;, false, {
        id: &#x27;ds.adapter.default-adapter-changing-to-json-api&#x27;,
        until: &#x27;2.0.0&#x27;
      });
    }

    let cache = this._cache;
    if (!cache[key]) {
      let instance = this._container.lookup(key);
      if (instance) {
        cache[key] = instance;
      }
    }
    return cache[key];
  },

  destroy: function() {
    let cache = this._cache;
    let cacheEntries = keysFunc(cache);

    for (let i = 0, length = cacheEntries.length; i &lt; length; i++) {
      let cacheKey = cacheEntries[i];
      let cacheEntry = cache[cacheKey];
      if (cacheEntry) {
        cacheEntry.destroy();
      }
    }
    this._container = null;
  },

  constructor: ContainerInstanceCache,

  toString: function() {
    return &#x27;ContainerInstanceCache&#x27;;
  }
});

export default ContainerInstanceCache;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
